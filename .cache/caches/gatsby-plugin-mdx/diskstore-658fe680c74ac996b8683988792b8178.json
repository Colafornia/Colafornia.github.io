{"expireTime":9007200825608117000,"key":"gatsby-plugin-mdx-entire-payload-0fb83a2f5800c68c41d2c4f914e31313-","val":{"mdast":{"type":"root","children":[{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"时间：2019.3","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":12,"offset":12},"indent":[]}}],"position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":12,"offset":12},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":12,"offset":12},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"Webpack 稳定版本为4, 正在 5 的 roadmap 中","position":{"start":{"line":4,"column":3,"offset":16},"end":{"line":4,"column":35,"offset":48},"indent":[]}}],"position":{"start":{"line":4,"column":3,"offset":16},"end":{"line":4,"column":35,"offset":48},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":14},"end":{"line":4,"column":35,"offset":48},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"记录一下当前时间对前端项目构建打包优化的策略","position":{"start":{"line":6,"column":3,"offset":52},"end":{"line":6,"column":25,"offset":74},"indent":[]}}],"position":{"start":{"line":6,"column":3,"offset":52},"end":{"line":6,"column":25,"offset":74},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":50},"end":{"line":6,"column":25,"offset":74},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"当前项目问题","position":{"start":{"line":8,"column":4,"offset":79},"end":{"line":8,"column":10,"offset":85},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":76},"end":{"line":8,"column":10,"offset":85},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"我们的前端项目基本都是使用的是 ","position":{"start":{"line":10,"column":1,"offset":87},"end":{"line":10,"column":17,"offset":103},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/facebook/create-react-app","children":[{"type":"text","value":"create-react-app","position":{"start":{"line":10,"column":18,"offset":104},"end":{"line":10,"column":34,"offset":120},"indent":[]}}],"position":{"start":{"line":10,"column":17,"offset":103},"end":{"line":10,"column":81,"offset":167},"indent":[]}},{"type":"text","value":" 的配置，冗余项太多，升级难。","position":{"start":{"line":10,"column":81,"offset":167},"end":{"line":10,"column":96,"offset":182},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":87},"end":{"line":10,"column":96,"offset":182},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"在这个前提下，有个“极限项目”每次代码改动之后的 hot reload 都需要 30s，实在坐不住了，就动手做了打包升级。","position":{"start":{"line":12,"column":1,"offset":184},"end":{"line":12,"column":62,"offset":245},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":184},"end":{"line":12,"column":62,"offset":245},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://s2.ax1x.com/2019/06/01/V1dq29.png","alt":"before","position":{"start":{"line":14,"column":1,"offset":247},"end":{"line":14,"column":53,"offset":299},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":247},"end":{"line":14,"column":53,"offset":299},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"这次是从代码依赖相对简单，后续测试回滚负担小的后台管理系统下手的。","position":{"start":{"line":16,"column":1,"offset":301},"end":{"line":16,"column":34,"offset":334},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":301},"end":{"line":16,"column":34,"offset":334},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"总结下当前的痛点为：","position":{"start":{"line":18,"column":1,"offset":336},"end":{"line":18,"column":11,"offset":346},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":336},"end":{"line":18,"column":11,"offset":346},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"项目启动慢","position":{"start":{"line":20,"column":4,"offset":351},"end":{"line":20,"column":9,"offset":356},"indent":[]}}],"position":{"start":{"line":20,"column":4,"offset":351},"end":{"line":20,"column":9,"offset":356},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":348},"end":{"line":20,"column":9,"offset":356},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Hot reload 慢","position":{"start":{"line":21,"column":4,"offset":360},"end":{"line":21,"column":16,"offset":372},"indent":[]}}],"position":{"start":{"line":21,"column":4,"offset":360},"end":{"line":21,"column":16,"offset":372},"indent":[]}}],"position":{"start":{"line":21,"column":1,"offset":357},"end":{"line":21,"column":16,"offset":372},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Build 慢（上线前在后端项目里 build 时尤其明显）","position":{"start":{"line":22,"column":4,"offset":376},"end":{"line":22,"column":34,"offset":406},"indent":[]}}],"position":{"start":{"line":22,"column":4,"offset":376},"end":{"line":22,"column":34,"offset":406},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":373},"end":{"line":22,"column":34,"offset":406},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"没分包，文件体积太大","position":{"start":{"line":23,"column":4,"offset":410},"end":{"line":23,"column":14,"offset":420},"indent":[]}}],"position":{"start":{"line":23,"column":4,"offset":410},"end":{"line":23,"column":14,"offset":420},"indent":[]}}],"position":{"start":{"line":23,"column":1,"offset":407},"end":{"line":23,"column":14,"offset":420},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":348},"end":{"line":23,"column":14,"offset":420},"indent":[1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"解决手段","position":{"start":{"line":25,"column":4,"offset":425},"end":{"line":25,"column":8,"offset":429},"indent":[]}}],"position":{"start":{"line":25,"column":1,"offset":422},"end":{"line":25,"column":8,"offset":429},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"首先把 Webpack 版本从 3 升到 4，起码先享受上工具本身升级后带来的优越性","position":{"start":{"line":27,"column":1,"offset":431},"end":{"line":27,"column":43,"offset":473},"indent":[]}}],"position":{"start":{"line":27,"column":1,"offset":431},"end":{"line":27,"column":43,"offset":473},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"1.分离配置文件（与性能无关，与开发维护体验有关）","position":{"start":{"line":29,"column":5,"offset":479},"end":{"line":29,"column":30,"offset":504},"indent":[]}}],"position":{"start":{"line":29,"column":1,"offset":475},"end":{"line":29,"column":30,"offset":504},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"分成 base、dev、prod 三个 config 文件","position":{"start":{"line":31,"column":1,"offset":506},"end":{"line":31,"column":30,"offset":535},"indent":[]}}],"position":{"start":{"line":31,"column":1,"offset":506},"end":{"line":31,"column":30,"offset":535},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"把通用配置放到 base 中，dev 与 prod 中只放与这两种模式强相关的配置","position":{"start":{"line":33,"column":1,"offset":537},"end":{"line":33,"column":42,"offset":578},"indent":[]}}],"position":{"start":{"line":33,"column":1,"offset":537},"end":{"line":33,"column":42,"offset":578},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"2.HappyPack","position":{"start":{"line":35,"column":5,"offset":584},"end":{"line":35,"column":16,"offset":595},"indent":[]}}],"position":{"start":{"line":35,"column":1,"offset":580},"end":{"line":35,"column":16,"offset":595},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://s2.ax1x.com/2019/06/01/V1db8J.png","alt":"HappyPack","position":{"start":{"line":37,"column":1,"offset":597},"end":{"line":37,"column":56,"offset":652},"indent":[]}}],"position":{"start":{"line":37,"column":1,"offset":597},"end":{"line":37,"column":56,"offset":652},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"治疗各种编译慢","position":{"start":{"line":39,"column":1,"offset":654},"end":{"line":39,"column":8,"offset":661},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":654},"end":{"line":39,"column":8,"offset":661},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"本地启动 server 编译时间： 30s => 10s","position":{"start":{"line":41,"column":1,"offset":663},"end":{"line":41,"column":29,"offset":691},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":663},"end":{"line":41,"column":29,"offset":691},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"3.splitChunks 分包","position":{"start":{"line":43,"column":5,"offset":697},"end":{"line":43,"column":21,"offset":713},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":693},"end":{"line":43,"column":21,"offset":713},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://s2.ax1x.com/2019/06/01/V1dXK1.png","alt":"splitChunks","position":{"start":{"line":45,"column":1,"offset":715},"end":{"line":45,"column":58,"offset":772},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":715},"end":{"line":45,"column":58,"offset":772},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"这一功能在之前版本中是通过 ","position":{"start":{"line":47,"column":1,"offset":774},"end":{"line":47,"column":15,"offset":788},"indent":[]}},{"type":"link","title":null,"url":"https://webpack.js.org/plugins/commons-chunk-plugin/","children":[{"type":"text","value":"CommonsChunkPlugin","position":{"start":{"line":47,"column":16,"offset":789},"end":{"line":47,"column":34,"offset":807},"indent":[]}}],"position":{"start":{"line":47,"column":15,"offset":788},"end":{"line":47,"column":89,"offset":862},"indent":[]}},{"type":"text","value":" 来进行的。","position":{"start":{"line":47,"column":89,"offset":862},"end":{"line":47,"column":95,"offset":868},"indent":[]}}],"position":{"start":{"line":47,"column":1,"offset":774},"end":{"line":47,"column":95,"offset":868},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"初步分成三个包，减小 main 包体积。","position":{"start":{"line":49,"column":1,"offset":870},"end":{"line":49,"column":21,"offset":890},"indent":[]}}],"position":{"start":{"line":49,"column":1,"offset":870},"end":{"line":49,"column":21,"offset":890},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"根据业务特点，其实可以做懒加载，但是注意不能分太多，增加 http 请求数得不偿失。后台管理项目体积目前不大，各模块也没什么业务上的明显区分，就没啥做懒加载的必要。","position":{"start":{"line":51,"column":1,"offset":892},"end":{"line":51,"column":83,"offset":974},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":892},"end":{"line":51,"column":83,"offset":974},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"结果：包体积：6M => 3M","position":{"start":{"line":53,"column":1,"offset":976},"end":{"line":53,"column":16,"offset":991},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":976},"end":{"line":53,"column":16,"offset":991},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"4.将第三方巨型包打入 externals","position":{"start":{"line":55,"column":5,"offset":997},"end":{"line":55,"column":26,"offset":1018},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":993},"end":{"line":55,"column":26,"offset":1018},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"经过以上分包后，用 ","position":{"start":{"line":57,"column":1,"offset":1020},"end":{"line":57,"column":11,"offset":1030},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/webpack-contrib/webpack-bundle-analyzer","children":[{"type":"text","value":"BundleAnalyzerPlugin","position":{"start":{"line":57,"column":12,"offset":1031},"end":{"line":57,"column":32,"offset":1051},"indent":[]}}],"position":{"start":{"line":57,"column":11,"offset":1030},"end":{"line":57,"column":93,"offset":1112},"indent":[]}},{"type":"text","value":" 看了下结果","position":{"start":{"line":57,"column":93,"offset":1112},"end":{"line":57,"column":99,"offset":1118},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":1020},"end":{"line":57,"column":99,"offset":1118},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"发现有个非常显眼的巨型包 ","position":{"start":{"line":59,"column":1,"offset":1120},"end":{"line":59,"column":14,"offset":1133},"indent":[]}},{"type":"inlineCode","value":"echarts","position":{"start":{"line":59,"column":14,"offset":1133},"end":{"line":59,"column":23,"offset":1142},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":1120},"end":{"line":59,"column":23,"offset":1142},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"把它的 min.js 扔到公司 cdn 上，在 html 中直接引入：","position":{"start":{"line":61,"column":1,"offset":1144},"end":{"line":61,"column":36,"offset":1179},"indent":[]}}],"position":{"start":{"line":61,"column":1,"offset":1144},"end":{"line":61,"column":36,"offset":1179},"indent":[]}},{"type":"code","lang":"javascript","meta":null,"value":"  externals: {\n    echarts: 'echarts'\n  }","position":{"start":{"line":63,"column":1,"offset":1181},"end":{"line":67,"column":4,"offset":1240},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"效果也很明显，当时没截图，就不贴对比图了","position":{"start":{"line":69,"column":1,"offset":1242},"end":{"line":69,"column":21,"offset":1262},"indent":[]}}],"position":{"start":{"line":69,"column":1,"offset":1242},"end":{"line":69,"column":21,"offset":1262},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"5.gzip","position":{"start":{"line":71,"column":5,"offset":1268},"end":{"line":71,"column":11,"offset":1274},"indent":[]}}],"position":{"start":{"line":71,"column":1,"offset":1264},"end":{"line":71,"column":11,"offset":1274},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://s2.ax1x.com/2019/06/01/V1dLvR.png","alt":"after","position":{"start":{"line":73,"column":1,"offset":1276},"end":{"line":73,"column":52,"offset":1327},"indent":[]}}],"position":{"start":{"line":73,"column":1,"offset":1276},"end":{"line":73,"column":52,"offset":1327},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"通过引入 CompressionWebpackPlugin 插件，打出来 .js.gz 资源，在服务器已支持 gzip 的情况下，所加载资源体积（直接到了 1.3M）和时间提升非常明显","position":{"start":{"line":75,"column":1,"offset":1329},"end":{"line":75,"column":93,"offset":1421},"indent":[]}}],"position":{"start":{"line":75,"column":1,"offset":1329},"end":{"line":75,"column":93,"offset":1421},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"6.常规操作","position":{"start":{"line":77,"column":5,"offset":1427},"end":{"line":77,"column":11,"offset":1433},"indent":[]}}],"position":{"start":{"line":77,"column":1,"offset":1423},"end":{"line":77,"column":11,"offset":1433},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"还有很多升到 webpack@4 之后的常规操作：","position":{"start":{"line":78,"column":1,"offset":1434},"end":{"line":78,"column":26,"offset":1459},"indent":[]}}],"position":{"start":{"line":78,"column":1,"offset":1434},"end":{"line":78,"column":26,"offset":1459},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"MiniCssExtractPlugin","position":{"start":{"line":80,"column":3,"offset":1463},"end":{"line":80,"column":23,"offset":1483},"indent":[]}}],"position":{"start":{"line":80,"column":3,"offset":1463},"end":{"line":80,"column":23,"offset":1483},"indent":[]}}],"position":{"start":{"line":80,"column":1,"offset":1461},"end":{"line":80,"column":23,"offset":1483},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"TerserPlugin","position":{"start":{"line":82,"column":3,"offset":1487},"end":{"line":82,"column":15,"offset":1499},"indent":[]}}],"position":{"start":{"line":82,"column":3,"offset":1487},"end":{"line":82,"column":15,"offset":1499},"indent":[]}}],"position":{"start":{"line":82,"column":1,"offset":1485},"end":{"line":82,"column":15,"offset":1499},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"OptimizeCSSAssetsPlugin","position":{"start":{"line":84,"column":3,"offset":1503},"end":{"line":84,"column":26,"offset":1526},"indent":[]}}],"position":{"start":{"line":84,"column":3,"offset":1503},"end":{"line":84,"column":26,"offset":1526},"indent":[]}}],"position":{"start":{"line":84,"column":1,"offset":1501},"end":{"line":84,"column":26,"offset":1526},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"等等","position":{"start":{"line":86,"column":3,"offset":1530},"end":{"line":86,"column":5,"offset":1532},"indent":[]}}],"position":{"start":{"line":86,"column":3,"offset":1530},"end":{"line":86,"column":5,"offset":1532},"indent":[]}}],"position":{"start":{"line":86,"column":1,"offset":1528},"end":{"line":86,"column":5,"offset":1532},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"随便搜搜，或者按图索骥去最新版的 create-react-app 源码里看看用了啥就行","position":{"start":{"line":88,"column":1,"offset":1534},"end":{"line":88,"column":45,"offset":1578},"indent":[]}}],"position":{"start":{"line":88,"column":1,"offset":1534},"end":{"line":88,"column":45,"offset":1578},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"Webpack optimization in 03/2019\",\"description\":\"better build performance strategy\",\"date\":\"2019-03-31T18:00:00.000Z\",\"published\":true,\"cover\":\"./2019-3-webpack.png\",\"coverAuthor\":\"Unknown\",\"coverOriginalUrl\":\"https://www.google.com\"}","position":{"start":{"line":91,"column":1,"offset":1581},"end":{"line":91,"column":272,"offset":1852},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":91,"column":272,"offset":1852}}},"scopeImports":["import React from 'react'"],"scopeIdentifiers":["React"],"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Webpack optimization in 03/2019\",\n  \"description\": \"better build performance strategy\",\n  \"date\": \"2019-03-31T18:00:00.000Z\",\n  \"published\": true,\n  \"cover\": \"./2019-3-webpack.png\",\n  \"coverAuthor\": \"Unknown\",\n  \"coverOriginalUrl\": \"https://www.google.com\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u65F6\\u95F4\\uFF1A2019.3\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Webpack \\u7A33\\u5B9A\\u7248\\u672C\\u4E3A4, \\u6B63\\u5728 5 \\u7684 roadmap \\u4E2D\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u8BB0\\u5F55\\u4E00\\u4E0B\\u5F53\\u524D\\u65F6\\u95F4\\u5BF9\\u524D\\u7AEF\\u9879\\u76EE\\u6784\\u5EFA\\u6253\\u5305\\u4F18\\u5316\\u7684\\u7B56\\u7565\")), mdx(\"h2\", {\n    \"id\": \"当前项目问题\"\n  }, \"\\u5F53\\u524D\\u9879\\u76EE\\u95EE\\u9898\"), mdx(\"p\", null, \"\\u6211\\u4EEC\\u7684\\u524D\\u7AEF\\u9879\\u76EE\\u57FA\\u672C\\u90FD\\u662F\\u4F7F\\u7528\\u7684\\u662F \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/facebook/create-react-app\"\n  }), \"create-react-app\"), \" \\u7684\\u914D\\u7F6E\\uFF0C\\u5197\\u4F59\\u9879\\u592A\\u591A\\uFF0C\\u5347\\u7EA7\\u96BE\\u3002\"), mdx(\"p\", null, \"\\u5728\\u8FD9\\u4E2A\\u524D\\u63D0\\u4E0B\\uFF0C\\u6709\\u4E2A\\u201C\\u6781\\u9650\\u9879\\u76EE\\u201D\\u6BCF\\u6B21\\u4EE3\\u7801\\u6539\\u52A8\\u4E4B\\u540E\\u7684 hot reload \\u90FD\\u9700\\u8981 30s\\uFF0C\\u5B9E\\u5728\\u5750\\u4E0D\\u4F4F\\u4E86\\uFF0C\\u5C31\\u52A8\\u624B\\u505A\\u4E86\\u6253\\u5305\\u5347\\u7EA7\\u3002\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://s2.ax1x.com/2019/06/01/V1dq29.png\",\n    \"alt\": \"before\"\n  }))), mdx(\"p\", null, \"\\u8FD9\\u6B21\\u662F\\u4ECE\\u4EE3\\u7801\\u4F9D\\u8D56\\u76F8\\u5BF9\\u7B80\\u5355\\uFF0C\\u540E\\u7EED\\u6D4B\\u8BD5\\u56DE\\u6EDA\\u8D1F\\u62C5\\u5C0F\\u7684\\u540E\\u53F0\\u7BA1\\u7406\\u7CFB\\u7EDF\\u4E0B\\u624B\\u7684\\u3002\"), mdx(\"p\", null, \"\\u603B\\u7ED3\\u4E0B\\u5F53\\u524D\\u7684\\u75DB\\u70B9\\u4E3A\\uFF1A\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u9879\\u76EE\\u542F\\u52A8\\u6162\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Hot reload \\u6162\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Build \\u6162\\uFF08\\u4E0A\\u7EBF\\u524D\\u5728\\u540E\\u7AEF\\u9879\\u76EE\\u91CC build \\u65F6\\u5C24\\u5176\\u660E\\u663E\\uFF09\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u6CA1\\u5206\\u5305\\uFF0C\\u6587\\u4EF6\\u4F53\\u79EF\\u592A\\u5927\")), mdx(\"h2\", {\n    \"id\": \"解决手段\"\n  }, \"\\u89E3\\u51B3\\u624B\\u6BB5\"), mdx(\"p\", null, \"\\u9996\\u5148\\u628A Webpack \\u7248\\u672C\\u4ECE 3 \\u5347\\u5230 4\\uFF0C\\u8D77\\u7801\\u5148\\u4EAB\\u53D7\\u4E0A\\u5DE5\\u5177\\u672C\\u8EAB\\u5347\\u7EA7\\u540E\\u5E26\\u6765\\u7684\\u4F18\\u8D8A\\u6027\"), mdx(\"h3\", {\n    \"id\": \"1分离配置文件（与性能无关，与开发维护体验有关）\"\n  }, \"1.\\u5206\\u79BB\\u914D\\u7F6E\\u6587\\u4EF6\\uFF08\\u4E0E\\u6027\\u80FD\\u65E0\\u5173\\uFF0C\\u4E0E\\u5F00\\u53D1\\u7EF4\\u62A4\\u4F53\\u9A8C\\u6709\\u5173\\uFF09\"), mdx(\"p\", null, \"\\u5206\\u6210 base\\u3001dev\\u3001prod \\u4E09\\u4E2A config \\u6587\\u4EF6\"), mdx(\"p\", null, \"\\u628A\\u901A\\u7528\\u914D\\u7F6E\\u653E\\u5230 base \\u4E2D\\uFF0Cdev \\u4E0E prod \\u4E2D\\u53EA\\u653E\\u4E0E\\u8FD9\\u4E24\\u79CD\\u6A21\\u5F0F\\u5F3A\\u76F8\\u5173\\u7684\\u914D\\u7F6E\"), mdx(\"h3\", {\n    \"id\": \"2happypack\"\n  }, \"2.HappyPack\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://s2.ax1x.com/2019/06/01/V1db8J.png\",\n    \"alt\": \"HappyPack\"\n  }))), mdx(\"p\", null, \"\\u6CBB\\u7597\\u5404\\u79CD\\u7F16\\u8BD1\\u6162\"), mdx(\"p\", null, \"\\u672C\\u5730\\u542F\\u52A8 server \\u7F16\\u8BD1\\u65F6\\u95F4\\uFF1A 30s => 10s\"), mdx(\"h3\", {\n    \"id\": \"3splitchunks-分包\"\n  }, \"3.splitChunks \\u5206\\u5305\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://s2.ax1x.com/2019/06/01/V1dXK1.png\",\n    \"alt\": \"splitChunks\"\n  }))), mdx(\"p\", null, \"\\u8FD9\\u4E00\\u529F\\u80FD\\u5728\\u4E4B\\u524D\\u7248\\u672C\\u4E2D\\u662F\\u901A\\u8FC7 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://webpack.js.org/plugins/commons-chunk-plugin/\"\n  }), \"CommonsChunkPlugin\"), \" \\u6765\\u8FDB\\u884C\\u7684\\u3002\"), mdx(\"p\", null, \"\\u521D\\u6B65\\u5206\\u6210\\u4E09\\u4E2A\\u5305\\uFF0C\\u51CF\\u5C0F main \\u5305\\u4F53\\u79EF\\u3002\"), mdx(\"p\", null, \"\\u6839\\u636E\\u4E1A\\u52A1\\u7279\\u70B9\\uFF0C\\u5176\\u5B9E\\u53EF\\u4EE5\\u505A\\u61D2\\u52A0\\u8F7D\\uFF0C\\u4F46\\u662F\\u6CE8\\u610F\\u4E0D\\u80FD\\u5206\\u592A\\u591A\\uFF0C\\u589E\\u52A0 http \\u8BF7\\u6C42\\u6570\\u5F97\\u4E0D\\u507F\\u5931\\u3002\\u540E\\u53F0\\u7BA1\\u7406\\u9879\\u76EE\\u4F53\\u79EF\\u76EE\\u524D\\u4E0D\\u5927\\uFF0C\\u5404\\u6A21\\u5757\\u4E5F\\u6CA1\\u4EC0\\u4E48\\u4E1A\\u52A1\\u4E0A\\u7684\\u660E\\u663E\\u533A\\u5206\\uFF0C\\u5C31\\u6CA1\\u5565\\u505A\\u61D2\\u52A0\\u8F7D\\u7684\\u5FC5\\u8981\\u3002\"), mdx(\"p\", null, \"\\u7ED3\\u679C\\uFF1A\\u5305\\u4F53\\u79EF\\uFF1A6M => 3M\"), mdx(\"h3\", {\n    \"id\": \"4将第三方巨型包打入-externals\"\n  }, \"4.\\u5C06\\u7B2C\\u4E09\\u65B9\\u5DE8\\u578B\\u5305\\u6253\\u5165 externals\"), mdx(\"p\", null, \"\\u7ECF\\u8FC7\\u4EE5\\u4E0A\\u5206\\u5305\\u540E\\uFF0C\\u7528 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/webpack-contrib/webpack-bundle-analyzer\"\n  }), \"BundleAnalyzerPlugin\"), \" \\u770B\\u4E86\\u4E0B\\u7ED3\\u679C\"), mdx(\"p\", null, \"\\u53D1\\u73B0\\u6709\\u4E2A\\u975E\\u5E38\\u663E\\u773C\\u7684\\u5DE8\\u578B\\u5305 \", mdx(\"code\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"echarts\")), mdx(\"p\", null, \"\\u628A\\u5B83\\u7684 min.js \\u6254\\u5230\\u516C\\u53F8 cdn \\u4E0A\\uFF0C\\u5728 html \\u4E2D\\u76F4\\u63A5\\u5F15\\u5165\\uFF1A\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"javascript\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-javascript line-numbers\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"  externals\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \":\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"{\"), \"\\n    echarts\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \":\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token string\"\n  }), \"'echarts'\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"}\")), mdx(\"span\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"\\u6548\\u679C\\u4E5F\\u5F88\\u660E\\u663E\\uFF0C\\u5F53\\u65F6\\u6CA1\\u622A\\u56FE\\uFF0C\\u5C31\\u4E0D\\u8D34\\u5BF9\\u6BD4\\u56FE\\u4E86\"), mdx(\"h3\", {\n    \"id\": \"5gzip\"\n  }, \"5.gzip\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://s2.ax1x.com/2019/06/01/V1dLvR.png\",\n    \"alt\": \"after\"\n  }))), mdx(\"p\", null, \"\\u901A\\u8FC7\\u5F15\\u5165 CompressionWebpackPlugin \\u63D2\\u4EF6\\uFF0C\\u6253\\u51FA\\u6765 .js.gz \\u8D44\\u6E90\\uFF0C\\u5728\\u670D\\u52A1\\u5668\\u5DF2\\u652F\\u6301 gzip \\u7684\\u60C5\\u51B5\\u4E0B\\uFF0C\\u6240\\u52A0\\u8F7D\\u8D44\\u6E90\\u4F53\\u79EF\\uFF08\\u76F4\\u63A5\\u5230\\u4E86 1.3M\\uFF09\\u548C\\u65F6\\u95F4\\u63D0\\u5347\\u975E\\u5E38\\u660E\\u663E\"), mdx(\"h3\", {\n    \"id\": \"6常规操作\"\n  }, \"6.\\u5E38\\u89C4\\u64CD\\u4F5C\"), mdx(\"p\", null, \"\\u8FD8\\u6709\\u5F88\\u591A\\u5347\\u5230 webpack@4 \\u4E4B\\u540E\\u7684\\u5E38\\u89C4\\u64CD\\u4F5C\\uFF1A\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"MiniCssExtractPlugin\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"TerserPlugin\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"OptimizeCSSAssetsPlugin\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u7B49\\u7B49\")), mdx(\"p\", null, \"\\u968F\\u4FBF\\u641C\\u641C\\uFF0C\\u6216\\u8005\\u6309\\u56FE\\u7D22\\u9AA5\\u53BB\\u6700\\u65B0\\u7248\\u7684 create-react-app \\u6E90\\u7801\\u91CC\\u770B\\u770B\\u7528\\u4E86\\u5565\\u5C31\\u884C\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"Webpack optimization in 03/2019\",\n  \"description\": \"better build performance strategy\",\n  \"date\": \"2019-03-31T18:00:00.000Z\",\n  \"published\": true,\n  \"cover\": \"./2019-3-webpack.png\",\n  \"coverAuthor\": \"Unknown\",\n  \"coverOriginalUrl\": \"https://www.google.com\"\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <blockquote>\n      <p parentName=\"blockquote\">{`时间：2019.3`}</p>\n    </blockquote>\n    <blockquote>\n      <p parentName=\"blockquote\">{`Webpack 稳定版本为4, 正在 5 的 roadmap 中`}</p>\n    </blockquote>\n    <blockquote>\n      <p parentName=\"blockquote\">{`记录一下当前时间对前端项目构建打包优化的策略`}</p>\n    </blockquote>\n    <h2 {...{\n      \"id\": \"当前项目问题\"\n    }}>{`当前项目问题`}</h2>\n    <p>{`我们的前端项目基本都是使用的是 `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/facebook/create-react-app\"\n      }}>{`create-react-app`}</a>{` 的配置，冗余项太多，升级难。`}</p>\n    <p>{`在这个前提下，有个“极限项目”每次代码改动之后的 hot reload 都需要 30s，实在坐不住了，就动手做了打包升级。`}</p>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://s2.ax1x.com/2019/06/01/V1dq29.png\",\n        \"alt\": \"before\"\n      }}></img></p>\n    <p>{`这次是从代码依赖相对简单，后续测试回滚负担小的后台管理系统下手的。`}</p>\n    <p>{`总结下当前的痛点为：`}</p>\n    <ol>\n      <li parentName=\"ol\">{`项目启动慢`}</li>\n      <li parentName=\"ol\">{`Hot reload 慢`}</li>\n      <li parentName=\"ol\">{`Build 慢（上线前在后端项目里 build 时尤其明显）`}</li>\n      <li parentName=\"ol\">{`没分包，文件体积太大`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"解决手段\"\n    }}>{`解决手段`}</h2>\n    <p>{`首先把 Webpack 版本从 3 升到 4，起码先享受上工具本身升级后带来的优越性`}</p>\n    <h3 {...{\n      \"id\": \"1分离配置文件（与性能无关，与开发维护体验有关）\"\n    }}>{`1.分离配置文件（与性能无关，与开发维护体验有关）`}</h3>\n    <p>{`分成 base、dev、prod 三个 config 文件`}</p>\n    <p>{`把通用配置放到 base 中，dev 与 prod 中只放与这两种模式强相关的配置`}</p>\n    <h3 {...{\n      \"id\": \"2happypack\"\n    }}>{`2.HappyPack`}</h3>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://s2.ax1x.com/2019/06/01/V1db8J.png\",\n        \"alt\": \"HappyPack\"\n      }}></img></p>\n    <p>{`治疗各种编译慢`}</p>\n    <p>{`本地启动 server 编译时间： 30s => 10s`}</p>\n    <h3 {...{\n      \"id\": \"3splitchunks-分包\"\n    }}>{`3.splitChunks 分包`}</h3>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://s2.ax1x.com/2019/06/01/V1dXK1.png\",\n        \"alt\": \"splitChunks\"\n      }}></img></p>\n    <p>{`这一功能在之前版本中是通过 `}<a parentName=\"p\" {...{\n        \"href\": \"https://webpack.js.org/plugins/commons-chunk-plugin/\"\n      }}>{`CommonsChunkPlugin`}</a>{` 来进行的。`}</p>\n    <p>{`初步分成三个包，减小 main 包体积。`}</p>\n    <p>{`根据业务特点，其实可以做懒加载，但是注意不能分太多，增加 http 请求数得不偿失。后台管理项目体积目前不大，各模块也没什么业务上的明显区分，就没啥做懒加载的必要。`}</p>\n    <p>{`结果：包体积：6M => 3M`}</p>\n    <h3 {...{\n      \"id\": \"4将第三方巨型包打入-externals\"\n    }}>{`4.将第三方巨型包打入 externals`}</h3>\n    <p>{`经过以上分包后，用 `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/webpack-contrib/webpack-bundle-analyzer\"\n      }}>{`BundleAnalyzerPlugin`}</a>{` 看了下结果`}</p>\n    <p>{`发现有个非常显眼的巨型包 `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`echarts`}</code></p>\n    <p>{`把它的 min.js 扔到公司 cdn 上，在 html 中直接引入：`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"javascript\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-javascript line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-javascript\"\n        }}>{`  externals`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    echarts`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'echarts'`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`效果也很明显，当时没截图，就不贴对比图了`}</p>\n    <h3 {...{\n      \"id\": \"5gzip\"\n    }}>{`5.gzip`}</h3>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://s2.ax1x.com/2019/06/01/V1dLvR.png\",\n        \"alt\": \"after\"\n      }}></img></p>\n    <p>{`通过引入 CompressionWebpackPlugin 插件，打出来 .js.gz 资源，在服务器已支持 gzip 的情况下，所加载资源体积（直接到了 1.3M）和时间提升非常明显`}</p>\n    <h3 {...{\n      \"id\": \"6常规操作\"\n    }}>{`6.常规操作`}</h3>\n    <p>{`还有很多升到 webpack@4 之后的常规操作：`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\">{`MiniCssExtractPlugin`}</p>\n    </blockquote>\n    <blockquote>\n      <p parentName=\"blockquote\">{`TerserPlugin`}</p>\n    </blockquote>\n    <blockquote>\n      <p parentName=\"blockquote\">{`OptimizeCSSAssetsPlugin`}</p>\n    </blockquote>\n    <blockquote>\n      <p parentName=\"blockquote\">{`等等`}</p>\n    </blockquote>\n    <p>{`随便搜搜，或者按图索骥去最新版的 create-react-app 源码里看看用了啥就行`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}